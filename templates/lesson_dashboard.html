{% load aggregator %}
<html>
<head>
	<title>nhn classical music club lesson fee management app</title>
	<link rel="stylesheet" type="text/css" href="/media/css/base.css" />
	<!-- link href="/resources/base.css" rel="stylesheet" type="text/css" media="screen" / -->
</head>
<body class="change-list">
	<div id="container">
		<div id="header">
			<div id="branding">
				<h1>Lesson Apply Management</h1>
			</div>
		</div>

		<div id="content" class="flex">
			<table id="result_list" class="docutils">
				<colgroup>
					<col width="14" />
					<col width="23%" />
					<col width="10%" />
					<col width="8%" />
					<col width="20%" />
					<col width="5%" />
					<col width="5%" />
					<col width="5%" />
					<col width="5%" />
					<col width="5%" />
				</colgroup>
				<thead>
					<tr>
						<th class="head">레슨악기</th>
						<th>강사(인원, 금액)</th>
						<th>사번</th>
						<th>이름</th>
						<th>소속부서</th>
						<th>기본</th>
						<th>운영</th>
						<th>연주</th>
						<th>계</th>
						<th>중복</th>
					</tr>
				</thead>
				<tbody>
					{% for lesson, teachers in mapping.items %}
					<tr>
						<th rowspan="{{lesson.students}}"><a href="/lesson/{{lesson.id}}">{{lesson.alias}}</a></th>
						{% for teacher, students in teachers.items %}
							{% if not forloop.first %}</tr><tr>{% endif %}
							<th rowspan="{{teacher.students}}"><a href="/lesson/{{lesson.id}}/{{teacher.id}}">{{teacher.name}}</a> ({{teacher.students}}, {{students|sum}})</th>
							{% for student in students %}
								{% if not forloop.first %}</tr><tr>{% endif %}
								<td>
									{% if not student.is_member %}<span style="color:red">{{student.empid}}</span>{% else %}{{student.empid}}{% endif %}
								</td>
								<td>{{student.name}}</td>
								<td>{{student.department}}</td>
								<td>{{student.base}}</td>
								<td>{{student.operational}}</td>
								<td>{{student.performance}}</td>
								<td>{{student.net}}</td>
								<td>{% if student.applies > 1 %}<span style="color:red">*</span>{% endif %}</td>
							{% endfor %}
						{% endfor %}
					</tr>
					{% empty %}
					<tr>
						<td colspan="10">No members yet.</td>
					</tr>
					{% endfor %}
					<tr>
						<th>레슨: {{mapping|lesson_total}}종</th>
						<th>강사: {{mapping|teacher_total}}명</th>
						<th colspan="3">신청인원: {{reduced|student_total}}명</th>
						<th colspan="4">지원금액: {{reduced|fee_total}}원</th>
						<th></th>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</body>
</html>
